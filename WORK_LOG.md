# Clover Lotto 앱 개발 작업 일지

## 1. 작업 개요

Clover Lotto 기획서를 바탕으로 Flutter 앱과 백엔드 API의 MVP(최소 기능 제품) 버전을 개발했습니다. 작업은 기능 단위로 나누어 진행되었으며, 각 단계마다 빌드 검증 및 커밋이 이루어졌습니다.

---

## 2. 상세 작업 내역

### 2.1. Flutter 앱 초기 설정 및 구조화 (Commit: `28e8aa8`)

- **기본 구조 설정:** 기존의 지갑 예제 코드를 모두 삭제하고, 로또 앱을 위한 새로운 기본 구조를 설정했습니다.
- **하단 네비게이션 구현:** 기획서에 따라 홈, 내 번호, 명당, 커뮤니티의 4개 주요 섹션으로 구성된 하단 네비게이션 바를 추가했습니다.
- **화면 생성:** 각 탭에 해당하는 빈 화면 (`HomeScreen`, `MyNumbersScreen`, `LuckySpotsScreen`, `CommunityScreen`)을 생성하여 앞으로의 개발을 위한 기반을 마련했습니다.
- **빌드 환경 개선:** 오래된 Gradle 설정으로 인해 발생하던 Java 버전 호환성 문제를 해결했습니다.
  - Android Gradle Plugin 버전을 8.2.0으로 업데이트
  - Gradle 버전을 8.4로 업데이트
  - Kotlin 버전을 1.9.23으로 업데이트

### 2.2. 홈 화면 - 랜덤 로또 번호 생성 기능 (Commit: `37991d9`)

- **기능 구현:** 홈 화면에 '번호 생성' 버튼을 추가하고, 버튼 클릭 시 1~45 사이의 고유한 6개 숫자를 랜덤으로 생성하는 기능을 구현했습니다.
- **UI/UX:** 생성된 번호는 정렬 후, 숫자 범위에 따라 다른 색상의 원으로 시각화하여 보여주도록 UI를 개선했습니다.

### 2.3. 내 번호 화면 - 수동 번호 입력 및 조회 (Commit: `37991d9`)

- **기능 구현:** '내 번호' 화면에 로또 번호 6개와 회차를 직접 입력하고 저장할 수 있는 폼을 추가했습니다.
- **상태 관리:** 입력된 번호는 리스트에 추가되어 화면 하단에 표시되며, 간단한 유효성 검사(1-45 범위, 중복 여부) 로직을 포함했습니다.

### 2.4. 백엔드 API - 당첨 확인 엔드포인트 (Commit: `f2c52e6`)

- **프로젝트 구조 분석:** 다중 모듈 구조의 `clover-wallet` 프로젝트를 분석하여 `app` 모듈이 API 서버 역할을 하는 것을 확인했습니다.
- **빌드 문제 해결:** `desktopApp` 모듈의 빌드 오류가 전체 프로젝트 빌드를 막고 있어, 해당 모듈을 임시로 비활성화하여 API 모듈의 독립적인 빌드가 가능하도록 조치했습니다.
- **API 구현:** 로또 당첨 번호 확인을 위한 초기 API 엔드포인트를 추가했습니다.
  - `GET /v1/lotto/check-winnings` 엔드포인트를 처리하는 `LottoController`를 생성했습니다.
  - 실제 비즈니스 로직이 구현될 `LottoService`를 추가하고, 현재는 더미 데이터를 반환하도록 설정했습니다.
  - API 응답을 위한 DTO로 `LottoCheck`를 정의했습니다.

### 2.5. Flutter 앱 - 당첨 확인 API 연동 (Commit: `5eaaeaa`)

- **API 연동:** '내 번호' 화면에 '당첨 확인' 버튼을 추가하여 백엔드 API 호출을 트리거하도록 구현했습니다.
- **서비스 및 모델 생성:** API 통신을 담당하는 `LottoApiService`와 응답 데이터를 파싱하기 위한 `LottoWinnings` 데이터 모델을 생성했습니다.
- **비동기 처리:** `FutureBuilder`를 사용하여 비동기적으로 API 결과를 받아와 화면에 당첨 내역(더미 데이터)을 표시하도록 구현했습니다.

### 2.6. 커뮤니티 화면 - 기본 UI 구현 (Commit: `71814a0`)

- **UI 구현:** 커뮤니티 화면에 더미 데이터를 사용하여 게시물 목록을 표시하는 기본 UI를 구현했습니다.
- **컴포넌트:** 각 목록 항목에는 제목, 작성자, 작성일이 표시되며, 새 글 작성을 위한 플로팅 액션 버튼을 추가했습니다.
- **모델 생성:** 게시물 데이터를 위한 `Post` 모델을 생성했습니다.

### 2.7. 백엔드 API - 로또 당첨 확인 비교 로직 구현 및 사용자별 조회 기능 추가 (Commit: `01ca17e`)

- **로또 당첨 확인 비교 로직 구현:** `LottoService`에 로또 당첨 번호와 사용자 구매 번호를 비교하여 당첨 등수를 판별하는 로직을 구현했습니다.
- **사용자별 조회 기능 추가:** `LottoService.checkWinnings` 메서드가 `userId`를 받아 해당 사용자의 로또 게임을 조회하고 당첨 여부를 계산하도록 수정했습니다.
- **API 엔드포인트 수정:** `LottoController`의 `checkWinnings` 엔드포인트가 `userId`를 요청 파라미터로 받도록 수정했습니다.
- **의존성 주입:** `LottoGameRdbAdaptor`를 `LottoService`에 주입하여 사용자 게임 데이터를 가져오도록 했습니다.
- **QR 코드 파싱 기능 구현 및 빌드 오류 수정:**
    - `DocumentParser`를 리팩토링하여 동행복권 QR코드 스캔 결과 HTML을 파싱하는 기능을 개선하고, 당첨, 낙첨, 미추첨 상태를 모두 정확히 처리하도록 수정했습니다.
    - `ktlint` 후행 쉼표 규칙 위반을 수정했습니다.
    - `mainClass`를 정확히 지정하여 Spring Boot 실행 오류를 해결했습니다.
    - `LottoNumberExtractor`에 `@Component`를 추가하여 Bean 생성 오류를 해결했습니다.
    - `List` 타입 충돌을 해결하기 위해 명시적 import를 추가했습니다.
    - 불필요한 파서 임시 파일을 삭제했습니다.

### 2.8. Flutter 앱 - 내 번호 화면 데이터 영속성 구현 (shared_preferences) (Commit: `33f7afd`)

- **데이터 영속성 구현:** `shared_preferences` 패키지를 사용하여 '내 번호' 화면에서 사용자가 입력한 로또 번호 목록을 로컬에 저장하고 불러오는 기능을 구현했습니다.
- **로직 추가:** `MyNumbersScreen`의 `initState`에서 저장된 데이터를 로드하고, `_saveNumbers` 호출 시 데이터를 저장하도록 로직을 추가했습니다.
- **의존성 추가:** `pubspec.yaml`에 `shared_preferences` 의존성을 추가했습니다.

---

## 3. TODO 리스트 (향후 개발 계획)

### 3.1. MVP 기능 고도화

-   [x] **당첨 확인 기능 실체화 (백엔드):**
    -   [x] 로또 공식 웹사이트(동행복권) 크롤링 또는 API를 통해 실제 당첨 번호를 가져오는 로직 구현.
    -   [x] DB에 저장된 사용자의 로또 번호와 당첨 번호를 비교하여 당첨 등수를 판별하는 로직 구현.
-   [ ] **푸시 알림 (백엔드/프론트엔드):**
    -   [ ] Firebase Cloud Messaging(FCM) 등 푸시 서비스를 연동.
    -   [ ] 당첨 시 사용자에게 푸시 알림을 보내는 기능 구현.
### 2.9. 커뮤니티 기능 구현 및 리팩토링 (Provider)

- **백엔드 API 구현:** `clover-wallet` 서버에 커뮤니티 게시물 CRUD를 위한 API 엔드포인트를 구현했습니다. (`Post` 도메인/엔티티, `PostRepository`, `CommunityService`, `CommunityController` 추가)
- **프론트엔드 구현:**
    - API와 연동하여 게시물 목록을 불러오는 기능을 구현했습니다.
    - 새 게시물을 작성하고 서버에 전송하는 `CreatePostScreen`을 구현했습니다.
- **상태관리 리팩토링:**
    - 기존의 `setState` 기반 상태 관리를 `Provider` 패턴으로 리팩토링했습니다.
    - `CommunityViewModel`을 생성하여 API 호출 및 상태(로딩, 데이터, 에러) 관리를 위임했습니다.
    - `CommunityScreen`과 `CreatePostScreen`이 `CommunityViewModel`을 사용하도록 수정하여 코드 구조를 개선하고 테스트 용이성을 높였습니다.
- **테스트 코드 작성:** `CommunityApiService`와 `CommunityViewModel`에 대한 단위 테스트를 작성하여 기능의 안정성을 확보했습니다.
- **빌드 환경 개선:** Android `compileSdkVersion`을 34로 업데이트하고, Kotlin 버전 불일치 경고를 해결하기 위해 Gradle 설정을 수정했습니다.

---

## 3. TODO 리스트 (향후 개발 계획)

### 3.1. MVP 기능 고도화

-   [x] **당첨 확인 기능 실체화 (백엔드):**
    -   [x] 로또 공식 웹사이트(동행복권) 크롤링 또는 API를 통해 실제 당첨 번호를 가져오는 로직 구현.
    -   [x] DB에 저장된 사용자의 로또 번호와 당첨 번호를 비교하여 당첨 등수를 판별하는 로직 구현.
-   [ ] **푸시 알림 (백엔드/프론트엔드):**
    -   [ ] Firebase Cloud Messaging(FCM) 등 푸시 서비스를 연동.
    -   [ ] 당첨 시 사용자에게 푸시 알림을 보내는 기능 구현.
-   [x] **커뮤니티 기능 확장:**
    -   [x] 게시물 목록 조회 및 작성 기능 구현 (UI 및 백엔드 API).
    -   [ ] 게시물 상세 보기 화면 구현.
    -   [ ] 게시물 수정, 삭제 기능 구현.
    -   [ ] 댓글 기능 추가.
-   [x] **데이터 영속성:**
    -   [x] '내 번호' 목록을 앱 재시작 후에도 유지되도록 로컬 저장소(SQLite, Hive 등)에 저장.
    -   [ ] 추후 사용자 계정 시스템과 연동하여 서버 DB에 저장.
-   [x] **상태관리 리팩토링:**
    -   [x] `Provider`를 도입하여 `Community` 기능의 상태 관리 구조 개선.

### 3.2. 2단계 기능 개발

-   [ ] **OCR 기반 로또 용지 스캔:**
    -   [ ] 카메라를 이용해 로또 용지를 촬영하고, OCR 기술로 번호를 자동 인식하여 '내 번호'에 추가하는 기능.
-   [ ] **전국 로또 명당 찾기:**
    -   [ ] 1등, 2등 배출점 데이터를 수집하여 DB에 저장 (백엔드).
    -   [ ] 지도(Google Maps, Naver Maps 등)와 연동하여 내 주변 또는 지역별 명당을 표시하는 화면 구현.
-   [ ] **구입 내역 기반 뱃지 시스템:**
    -   [ ] 로또 구매 횟수, 당첨 이력 등에 따라 사용자에게 뱃지를 부여하는 시스템 기획 및 구현.

### 3.3. 3단계 및 기타

-   [ ] **로또 명당 연계 여행 플랜 추천.**
-   [ ] **다양한 번호 추첨 알고리즘 추가.**
-   [ ] **전반적인 UI/UX 개선 및 애니메이션 추가.**
-   [x] **단위 테스트 및 통합 테스트 코드 작성:**
    -   [x] `CommunityApiService`, `CommunityViewModel` 단위 테스트 코드 작성.
